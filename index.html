<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Γραμματική</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div id="category-screen" class="category-screen">
            <h1 class="app-title">Επιλογή Κατηγορίας</h1>
            <p class="app-subtitle">Διάλεξε τι θέλεις να εξασκηθείς.</p>
            <div id="categories" class="categories-list"></div>
        </div>
        <div id="cards-container" style="display:none;">
            <div id="progressBarText" style="position:absolute;top:10px;right:14px;font-size:0.85rem;color:#235789;background:rgba(255,255,255,0.9);padding:6px 10px;border-radius:12px;z-index:50;box-shadow:0 2px 6px rgba(0,0,0,0.12);font-weight:600;letter-spacing:.5px;">
                0 / 0
            </div>
            <div class="card-3d" id="card3d">
            <div class="card-inner">
            <div class="question-section card-face active">
                <div class="content-box">
                    <object id="qSvg" data="syntax_q.svg" type="image/svg+xml" class="card-background" aria-label="Question Card"></object>
                    <div class="card-text question-text">
                        <div class="text-area"></div>
                    </div>

                    <form id="questionForm" class="input-area">
                        <label class="input-label">Σημείωσε την απάντηση σου:</label>
                        <input type="text" class="input-box" required>
                        <button type="submit" class="submit-btn">Υποβολή</button>
                    </form>
                </div>
            </div>
            <div class="answer-section card-face">
                <div class="content-box">
                    <object id="aSvg" data="syntax_a.svg" type="image/svg+xml" class="card-background" aria-label="Answer Card"></object>
                    <div class="card-text answer-text">
                        <div class="text-area"></div>
                    </div>

                    <div class="answer-content">
                        <button id="nextButton" class="next-btn">Επόμενη ερώτηση</button>
                    </div>
                </div>
            </div> <!-- .card-inner -->
            </div>
            </div> <!-- .card-3d -->
        </div>
    </div>
    <script>
        let currentQuestionIndex = 0;
        let questions = [];
        let categories = [];
        let currentCategory = null;

        // Fetch categories and render category screen
        async function loadCategories() {
            try {
                const response = await fetch('questions.json');
                const data = await response.json();
                categories = data.categories || [];
                renderCategories();
            } catch (e) {
                console.error(e);
                alert('Σφάλμα φόρτωσης κατηγοριών');
            }
        }

        function renderCategories() {
            const wrap = document.getElementById('categories');
            wrap.innerHTML = '';
            if (!categories.length) {
                wrap.innerHTML = '<p>Δεν υπάρχουν κατηγορίες.</p>';
                return;
            }
            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'category-btn';
                btn.innerHTML = `<span class="category-title">${cat.title}</span><span class="category-desc">${cat.description || ''}</span>`;
                btn.addEventListener('click', () => startCategory(cat.id));
                wrap.appendChild(btn);
            });
        }

        function startCategory(id) {
            const cat = categories.find(c => c.id === id);
            if (!cat) return;
            currentCategory = cat;
            questions = [...cat.questions];
            currentQuestionIndex = 0;
            document.getElementById('category-screen').style.display = 'none';
            document.getElementById('cards-container').style.display = 'block';
            // swap SVG assets depending on category
            const qSvg = document.getElementById('qSvg');
            const aSvg = document.getElementById('aSvg');
            if (qSvg && aSvg) {
                if (cat.id === 'grammar') {
                    qSvg.setAttribute('data', 'grammar_q.svg');
                    aSvg.setAttribute('data', 'grammar_a.svg');
                } else if (cat.id === 'syntax') {
                    qSvg.setAttribute('data', 'syntax_q.svg');
                    aSvg.setAttribute('data', 'syntax_a.svg');
                }
            }
            displayQuestion(0);
            document.querySelector('.question-section').classList.add('active');
            updateProgress();
        }

        function updateProgress() {
            const progressEl = document.getElementById('progressBarText');
            if (progressEl) {
                progressEl.textContent = `${currentQuestionIndex + 1} / ${questions.length}`;
            }
        }

        // Display current question
        function displayQuestion(index) {
            if (index >= questions.length) {
                return;
            }
            
            const q = questions[index];
            // fill question card
            const qText = document.querySelector('.question-section .question-text .text-area');
            const aText = document.querySelector('.answer-section .answer-text .text-area');
            qText.textContent = q.question;
            aText.textContent = q.answer;

            // Remove any previous user answer from the answer card
            const prevUser = document.querySelectorAll('.answer-section .answer-text .user-answer');
            prevUser.forEach(n => n.remove());

            // Reset form (input under the question)
            const form = document.getElementById('questionForm');
            const input = form.querySelector('input');
            const btn = form.querySelector('button');
            input.value = '';
            input.disabled = false;
            btn.disabled = false;

            // Update next button text if it's the last question
            const nextButton = document.getElementById('nextButton');
            nextButton.textContent = index === questions.length - 1 ? 'Τέλος' : 'Επόμενη ερώτηση';
            updateProgress();
        }

        // Handle form submission
        document.getElementById('questionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const answer = this.querySelector('input').value;
            if (answer.trim() !== '') {
                // flip to answer card (animation)
                const card3d = document.getElementById('card3d');
                if (card3d) card3d.classList.add('flipped');
                // also toggle visible sections for accessibility
                document.querySelector('.question-section').classList.remove('active');
                document.querySelector('.answer-section').classList.add('active');
                this.querySelector('input').disabled = true;
                this.querySelector('button').disabled = true;
                // optionally display user's typed answer somewhere on the answer card
                const userAns = document.querySelector('.answer-section .answer-text .text-area');
                // append user's answer below the official answer
                const userDiv = document.createElement('div');
                userDiv.className = 'user-answer';
                userDiv.textContent = 'Η απάντησή σου: ' + answer;
                userDiv.style.marginTop = '8px';
                userDiv.style.fontStyle = 'italic';
                userDiv.style.color = '#333';
                userAns.appendChild(userDiv);
            }
        });

        // Handle next button click
        document.getElementById('nextButton').addEventListener('click', function() {
            currentQuestionIndex++;
            if (currentQuestionIndex >= questions.length) {
                alert('Συγχαρητήρια! Ολοκληρώσατε την κατηγορία.');
                // return to category selection
                document.getElementById('cards-container').style.display = 'none';
                document.getElementById('category-screen').style.display = 'block';
                const card3d = document.getElementById('card3d');
                if (card3d) card3d.classList.remove('flipped');
                document.querySelector('.question-section').classList.add('active');
                document.querySelector('.answer-section').classList.remove('active');
                return;
            }
            
            // flip back to question card and show next
            const card3d = document.getElementById('card3d');
            if (card3d) card3d.classList.remove('flipped');
            document.querySelector('.question-section').classList.add('active');
            document.querySelector('.answer-section').classList.remove('active');
            displayQuestion(currentQuestionIndex);
        });

    // Start loading categories when page loads
    document.addEventListener('DOMContentLoaded', loadCategories);

        // Hide static titles inside the embedded SVGs if present (they duplicate our HTML overlays)
        function hideSvgTitles() {
            // try to access object SVG content
            const qObj = document.getElementById('qSvg');
            const aObj = document.getElementById('aSvg');

            function tryHide(obj) {
                try {
                    const svg = obj.contentDocument || obj.getSVGDocument && obj.getSVGDocument();
                    if (svg) {
                        // hide any <text> nodes that contain 'ΕΡΩΤΗΣΗ' or 'ΑΠΑΝΤΗΣΗ'
                        const texts = svg.querySelectorAll('text');
                        texts.forEach(t => {
                            const txt = (t.textContent || '').trim();
                            if (txt.includes('ΕΡΩΤΗΣΗ') || txt.includes('ΑΠΑΝΤΗΣΗ')) {
                                t.style.display = 'none';
                            }
                        });
                    }
                } catch (e) {
                    // cross-origin or unsupported; fall back to CSS-based hiding (handled by .card-text overlays)
                }
            }

            if (qObj) {
                qObj.addEventListener('load', () => tryHide(qObj));
                // try now in case it's already loaded
                tryHide(qObj);
            }
            if (aObj) {
                aObj.addEventListener('load', () => tryHide(aObj));
                tryHide(aObj);
            }
        }

        // Run hiding after small delay to ensure objects loaded in some browsers
        setTimeout(hideSvgTitles, 250);
    </script>
</body>
</html>
